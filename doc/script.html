<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: script in index.html</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: script in index.html</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext("2d");
        const filter = document.getElementById("the-filter");
        var result = document.getElementById("result");
        const video = document.getElementById("user-video");
        const sb = document.getElementById("searchButton");

        /**
         * loads the video on the frontend
         */
        const loadVideo = async() => {
            const video = document.getElementById("user-video");
            video.setAttribute("playsinline", "");
            video.setAttribute("autoplay", "");
            video.setAttribute("muted", "");
            video.style.width = "100%";
            video.style.height = "100%";

            const facingMode = "environment";
            const constraints = {
                audio: false,
                video: {
                    facingMode
                },
            };
            navigator.mediaDevices.getUserMedia(constraints).then((stream) => {
                video.srcObject = stream;
            });
        };
        /**
         * Takes a snapshot of the current camera frame when pressing the scan button on frontend 
         * and executes the recognizeText method with the picture as a parameter to let it process the image with OCR 
         */
        const takeSnapshot = () => {
            const context = canvas.getContext("2d");
            context.drawImage(video, 0, 0, 540, 380);
            image = canvas.toDataURL("image/png");
            context.src = image;
            const myImage = new Image(image);
            recognizeText(image);
            filter.focus();

            setTimeout(() => {
                filter.focus();
                sb.click();
                console.log("test");
            }, 2000);

        };

        const stopVideoButton = document.querySelector('#stop-button');

        let isstopped;
        
        /**
         * Stops the video when pressing the stop button on frontend
         */
        const stopvideo = () => {

            if (isstopped == true) {
                video.load();
                isstopped = false;
            } else {
                video.pause();
                isstopped = true;
            }

        }
   
        /**
         * Asynchronously creates buttons for every person working at wiso
         * @param names list of names 
         */
        const asyncForLoop = async(names) => {
            for (let i = 0; i &lt; names.length; i++) {
                document.getElementById("more").innerHTML +=
                    "&lt;li>&lt;button type='button' class='btn-primary' onclick= 'getDataInPopup(`" +
                    names[i] +
                    "`)'>" +
                    names[i] +
                    "&lt;/button>&lt;div id='" +
                    names[i] +
                    "'>&lt;/div>&lt;/li>";
            }
        };
        let wissnames;
        /**
         * Executes functions onload of the window in the browser to dynamically fill the frontend with names 
         * and activate the camera
         */
        const onLoadFunc = async() => {
            await loadVideo();
            let startTime = performance.now();
            let filter = document.getElementById("the-filter"); // search box 
            const crawlNameUrl = "/getnames"; // TODO: fetch from config.json
            const getInfo = async(url) => {
                const response = await fetch(url, {
                    method: "GET",
                });
                let infoArray = await response.json();
                return infoArray;
            };
            wissnames = await getInfo(crawlNameUrl);
            await asyncForLoop(wissnames);

            let endTime = performance.now();
            console.log("Time: " + (endTime - startTime));

            list = document.querySelectorAll("#wiso-list li"); // all list items

            // (B) ATTACH KEY UP LISTENER TO SEARCH BOX

            filter.onkeyup = () => {
                // (B1) GET CURRENT SEARCH TERM
                let search = filter.value.toLowerCase();

                // (B2) LOOP THROUGH LIST ITEMS - ONLY SHOW THOSE THAT MATCH SEARCH
                for (let i of list) {
                    let item = i.innerHTML.toLowerCase();
                    if (item.indexOf(search) == -1) {
                        i.classList.add("hide");
                    } else {
                        i.classList.remove("hide");
                    }
                }
            };

            sb.onclick = () => {
                // (B1) GET CURRENT SEARCH TERM
                let search = filter.value.toLowerCase();

                // (B2) LOOP THROUGH LIST ITEMS - ONLY SHOW THOSE THAT MATCH SEARCH
                for (let i of list) {
                    let item = i.innerHTML.toLowerCase();
                    if (item.indexOf(search) == -1) {
                        i.classList.add("hide");
                    } else {
                        i.classList.remove("hide");
                    }
                }
            };
        };
        window.onload = onLoadFunc;
   
        /**
         * Compares two strings and calculates the levenshteindistance of those 2 strings
         * @param str1, str2 strings to compare
         */
        const levenshteinDistance = (str1 = "", str2 = "") => {
            const track = Array(str2.length + 1)
                .fill(null)
                .map(() => Array(str1.length + 1).fill(null));
            for (let i = 0; i &lt;= str1.length; i += 1) {
                track[0][i] = i;
            }
            for (let j = 0; j &lt;= str2.length; j += 1) {
                track[j][0] = j;
            }
            for (let j = 1; j &lt;= str2.length; j += 1) {
                for (let i = 1; i &lt;= str1.length; i += 1) {
                    const indicator = str1[i - 1] === str2[j - 1] ? 0 : 1;
                    track[j][i] = Math.min(
                        track[j][i - 1] + 1, // deletion
                        track[j - 1][i] + 1, // insertion
                        track[j - 1][i - 1] + indicator // substitution
                    );
                }
            }
            return track[str2.length][str1.length];
        };
        /**
         * Searching for the closest levenshteindistance between the name recognized by the OCR and all the names of people working at wiso
         * If the distance is > 15, the search bar fills with the string "Too inaccurate try again!"
         * @Param text -> the name recognized by the OCR
         */
        function levin(text) {
            var lsv = [];

            //Change to getting the list from the crawler

            for (i = 0; i &lt; wissnames.length; i++) {
                lsv.push(levenshteinDistance(text, wissnames[i]));
                console.log(i + ": " + lsv[i]);
            }

            const min = Math.min(...lsv);

            if (min > 15) {
                filter.value = "Too inaccurate try again!";
            } else {
                console.log("Mininum Score: " + min);
                const index = lsv.indexOf(min);
                console.log("Index of the best fitting with lowest score: " + index);
                filter.value = wissnames[index];

            }
        }
        /**
         * Processes the image to detect text via OCR
         * @Param myImage -> the image to process
         */
        const recognizeText = (myImage) => {
            const {
                createWorker
            } = Tesseract;
            (async() => {
                const worker = createWorker();
                await worker.load();
                await worker.loadLanguage("deu");
                await worker.initialize("deu");
                const {
                    data: {
                        text
                    },
                } = await worker.recognize(myImage);
                console.log(text);
                filter.value = text;
                levin(text);
                await worker.terminate();
            })();
        };
  
        /**
         * Makes a HTTP POST request to the backend with the name of a person as a parameter to crawl univis for information about that person
         * @Param nameX -> the name of the person to retrieve information about
         */
        const getInfoAtButtonClick = async(nameX) => {
            const getInfoUrl = "/getinfo"; 
            const res = await fetch(getInfoUrl, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    name: nameX,
                }),
            });
            let responseText = await res.text();
            let responseObj = await JSON.parse(responseText);
            await console.log(Object.keys(responseObj));
            return responseObj;
        };

        let created = [];
        /**
         * 
         */
        const getDataInPopup = async(name) => {
            // Scape from puppeteer and save in array with name as name: name =  scapeWithName(name)
            // Change from data to name in the for loops in the lower Liebensteiner

            if (created.includes(name) == false) {
                console.log(name);
                created.push(name);
                let datax = "FAILED";
                try {
                    datax = await getInfoAtButtonClick(name);
                } catch (err) {
                    console.log("promise rejected")
                }
                document.getElementById("here").innerHTML +=
                    "&lt;div class='containerdata' id='container" +
                    name +
                    "'>&lt;div class='bg'>&lt;span class='close' id='close" +
                    name +
                    "'>&amp;times;&lt;/span>&lt;div id='dname'>" +
                    name +
                    "&lt;/div>&lt;div id='blue-balken'>&lt;/div>&lt;h5>Personaldaten&lt;/h5>&lt;div class='personaldata' id='personaldata" +
                    name +
                    "'>&lt;/div>&lt;div id='blue-balken'>&lt;/div>&lt;h5>Lehrstuhlmitarbeiter&lt;/h5>&lt;div class= 'arbeiter' id='arbeiter" +
                    name +
                    "'>&lt;/div>&lt;div id='blue-balken'>&lt;/div>&lt;h5>Lehrverstaltungen des Lehrstuhls&lt;/h5>&lt;div class='faecher' id='faecher" +
                    name +
                    "'>&lt;/div>&lt;/div>&lt;/div>";

                let personenDaten = "";
                let mitarbeiterDaten = "";
                let lehrveranstaltungenDaten = "";

                const getPopupdata = async() => {
                    console.log(Object.keys(datax));
                    for (i = 0; i &lt; datax.length; i++) {
                        console.log(datax[i]); + "STOP"
                    }
                    for (let i = 0; i &lt; datax["0"].length; i++) {
                        personenDaten += datax["0"][i] + "&lt;br />"; // for-loop will stop here! resulting in ["value1&lt;br />", "Value2", etc...]
                    }
                    for (let i = 0; i &lt; datax["1"].length; i++) {
                        mitarbeiterDaten += datax["1"][i] + "&lt;br />"; // for-loop will stop here! resulting in ["value1&lt;br />", "Value2", etc...]
                    }
                    for (let i = 0; i &lt; datax["2"].length; i++) {
                        lehrveranstaltungenDaten +=
                            datax["2"][i] + "&lt;br />"; // for-loop will stop here! resulting in ["value1&lt;br />", "Value2", etc...]
                    }
                    if (Object.keys(datax).length > 3) {
                        personenDaten += "&lt;hr style='height:1px;border:none;color:#333;background-color:#333;\ '/>";
                        for (let i = 0; i &lt; datax["3"].length; i++) {
                            personenDaten += datax["3"][i] + "&lt;br />"; // for-loop will stop here! resulting in ["value1&lt;br />", "Value2", etc...]
                        }
                        mitarbeiterDaten += "&lt;hr style='height:1px;border:none;color:#333;background-color:#333;\ '/>";
                        for (let i = 0; i &lt; datax["4"].length; i++) {
                            mitarbeiterDaten += datax["4"][i] + "&lt;br />"; // for-loop will stop here! resulting in ["value1&lt;br />", "Value2", etc...]
                        }
                        lehrveranstaltungenDaten += "&lt;hr style='heisght:1px;border:none;color:#333;background-color:#333;\ '/>";
                        for (let i = 0; i &lt; datax["5"].length; i++) {
                            lehrveranstaltungenDaten +=
                                datax["5"][i] + "&lt;br />"; // for-loop will stop here! resulting in ["value1&lt;br />", "Value2", etc...]
                        }
                    }
                    if (Object.keys(datax).length > 6) {
                        personenDaten += "&lt;hr style='height:1px;border:none;color:#333;background-color:#333;\ '/>";
                        for (let i = 0; i &lt; datax["6"].length; i++) {
                            personenDaten += datax["6"][i] + "&lt;br />"; // for-loop will stop here! resulting in ["value1&lt;br />", "Value2", etc...]
                        }
                        mitarbeiterDaten += "&lt;hr style='height:1px;border:none;color:#333;background-color:#333;\ '/>";
                        for (let i = 0; i &lt; datax["6"].length; i++) {
                            mitarbeiterDaten += datax["6"][i] + "&lt;br />"; // for-loop will stop here! resulting in ["value1&lt;br />", "Value2", etc...]
                        }
                        lehrveranstaltungenDaten += "&lt;hr style='height:1px;border:none;color:#333;background-color:#333;\ '/>";
                        for (let i = 0; i &lt; datax["6"].length; i++) {
                            lehrveranstaltungenDaten +=
                                datax["6"][i] + "&lt;br />"; // for-loop will stop here! resulting in ["value1&lt;br />", "Value2", etc...]
                        }
                    }

                    document.getElementById("personaldata" + name).innerHTML +=
                        personenDaten;
                    document.getElementById("arbeiter" + name).innerHTML +=
                        mitarbeiterDaten;
                    document.getElementById("faecher" + name).innerHTML +=
                        lehrveranstaltungenDaten;

                };
                await getPopupdata();

                // When the user clicks the button, open the modal
                let span = document.getElementById("close" + name);
                let modal = document.getElementById("container" + name);
                span.onclick = function() {
                    modal.style.display = "none";
                };
            } else {
                let span = document.getElementById("close" + name);
                let modal = document.getElementById("container" + name);
                console.log("Jetzt");
                modal.style.display = "block";
                // When the user clicks the button, open the modal
                span.onclick = function() {
                    modal.style.display = "none";
                }
            }
        }</code></pre>
        </article>
    </section>


    <h3 class="subsection-title">Methods</h3>

        
            

    

    
    <h4 class="name" id="asyncForLoop"><span class="type-signature">(async) </span>asyncForLoop<span class="signature">(names)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Asynchronously creates buttons for every person working at wiso
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>names</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last">list of names</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="script.html">script</a>, <a href="script.html#line74">line 74</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="getDataInPopup"><span class="type-signature">(async) </span>getDataInPopup<span class="signature">()</span><span class="type-signature"></span></h4>
    

    















<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="script.html">script</a>, <a href="script.html#line248">line 248</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="getInfoAtButtonClick"><span class="type-signature">(async) </span>getInfoAtButtonClick<span class="signature">(nameX)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Makes a HTTP POST request to the backend with the name of a person as a parameter to crawl univis for information about that person
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>nameX</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last">> the name of the person to retrieve information about</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="script.html">script</a>, <a href="script.html#line227">line 227</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="levenshteinDistance"><span class="type-signature"></span>levenshteinDistance<span class="signature">(str1,)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Compares two strings and calculates the levenshteindistance of those 2 strings
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>str1,</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last">str2 strings to compare</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="script.html">script</a>, <a href="script.html#line149">line 149</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="levin"><span class="type-signature"></span>levin<span class="signature">(text)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Searching for the closest levenshteindistance between the name recognized by the OCR and all the names of people working at wiso
If the distance is > 15, the search bar fills with the string "Too inaccurate try again!"
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>text</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last">> the name recognized by the OCR</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="script.html">script</a>, <a href="script.html#line176">line 176</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="loadVideo"><span class="type-signature">(async) </span>loadVideo<span class="signature">()</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    loads the video on the frontend
</div>













<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="script.html">script</a>, <a href="script.html#line11">line 11</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="onLoadFunc"><span class="type-signature">(async) </span>onLoadFunc<span class="signature">()</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Executes functions onload of the window in the browser to dynamically fill the frontend with names 
and activate the camera
</div>













<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="script.html">script</a>, <a href="script.html#line91">line 91</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="recognizeText"><span class="type-signature"></span>recognizeText<span class="signature">(myImage)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Processes the image to detect text via OCR
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>myImage</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last">> the image to process</td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="script.html">script</a>, <a href="script.html#line202">line 202</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="stopvideo"><span class="type-signature"></span>stopvideo<span class="signature">()</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Stops the video when pressing the stop button on frontend
</div>













<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="script.html">script</a>, <a href="script.html#line58">line 58</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="takeSnapshot"><span class="type-signature"></span>takeSnapshot<span class="signature">()</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    Takes a snapshot of the current camera frame when pressing the scan button on frontend 
and executes the recognizeText method with the picture as a parameter to let it process the image with OCR
</div>













<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="script.html">script</a>, <a href="script.html#line34">line 34</a>
    </li></ul></dd>
    

    

    

    
</dl>

</div>

<nav>
    <h2><a href="index.html">Home</a></h2>
    <h3><a href="global.html">Global</a></h3>
    <ul><li><a href="server.js.html">Server.js</a></li>
    <li><a href="script.html">Script in index.html</a></li>
</nav>

<br class="clear">


<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
